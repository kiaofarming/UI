<!DOCTYPE html>
<html>

<head>
  <title>KiaoFarming API </title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://code.jquery.com/jquery-3.6.4.min.js"
    integrity="sha256-oP6HI9z1XaZNBrJURtCoUT5SUnxFr8s3BzRl+cbzUq8=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.3.0/dist/chart.umd.min.js"></script>
  <script type="text/javascript" src="app.js"></script>
  <link rel="stylesheet" href="style.css">
</head>

<body>
  <div class="container">
    <nav class="nav-box">
      <input type="checkbox" id="menu">
      <label for="menu" class="line">
        <div class="menu"></div>
      </label>

      <div id='devMenu' class="menu-list">
        <div style="margin-top:15px;text-align: center;">
          <label id="show" class="addDevice">+ 新增</label>
          <label for="upload" class="custom-file-upload">
            <i class="fa fa-cloud-upload"></i> 載入
          </label>
          <input type='file' id="upload"/>
          <label id="download">下載</label>
        </div>
	<ul id="devMag"></ul>
      </div>
    </nav>
    <div class="zone">
      <label>區域：</label>
      <select class="zoneList">
        <option>陽台</option>
        <option>天台</option>
        <option>院子</option>
      </select>
    </div>
    <div id='devChart' style="width=350px;">
	<canvas id="tempChart"></canvas>
    </div>
    <div id='devList'>
    </div>
  </div>

  <dialog id="infoModal">
    <form id="myForm" class="wrap">
      <label>設備名稱 <br>
        <input type="text" id="name" required="required" /></label>
      <br>
      <label>SSID <br>
        <input type="text" id="valid_ssid" required="required" /></label>
      <br>
      <label>Device ID <br> <input type="text" id="valid_dev_id" required="required" /></label>
      <br>
      <label>第1路開關名稱 <br>
	<input type="checkbox" id="enable1" name="enable" value="1" checked />
	<input type="text" id="tags1" required="required" />
      </label>
      
      <br>
      <label>第2路開關名稱 <br>
	<input type="checkbox" id="enable2" name="enable" value="2" checked />
	<input type="text" id="tags2" required="required" />
      </label>

      <div id="valid_msg"></div>
      <div class="buttons">
        <button id="close" type='button' class="cancelBtn">關閉</button>
        <button id='close' type='submit' onclick="btnSubmit()" class="submitBtn">送出</button>
      </div>
    </form>
  </dialog>

<script>
  const ctx = document.getElementById('tempChart');

    var Labels =  ['ta1150','ta1223','ta1435','ta1567','ta1126','ta1622'];
    var Temps = [40.78,38.54,38.44,44.81,39.03,31.76 ];
    var Humis = [65.94,54.87,52.01,47.30,50.60,40.41];
    var Mosis = [15.94,24.87,32.01,17.30,20.60,10.41];
    var Luxs = [10.15,614.89,1563.57,174.31,787.08,1046.59,1];
    var reLuxs = [];

    for(let i=0;i<Luxs.length;i++) {
	let maxLux = Math.max.apply(null, Luxs);;
	reLuxs.push((Luxs[i] / maxLux) * 100);
    }

    console.log(reLuxs);

    var tempColor = "rgb(255, 99, 132)";
    var HumiColor = "rgb(132,175,243)";
    var LuxColor = "rgb(254, 162, 35)";
    var MosiColor = "rgb(124, 132, 15)";	

const tData = {
  labels: Labels,
  datasets: [{
    label: '溫度(°C)',
    data: Temps,
    fill: false,
    backgroundColor: tempColor,
    borderColor: tempColor,
    pointBackgroundColor: tempColor,
    pointBorderColor: '#fff',
    pointHoverBackgroundColor: '#fff',
    pointHoverBorderColor: tempColor
  },{
    label: '濕度(%)',
    data: Humis,
    fill: false,
    backgroundColor: HumiColor,
    borderColor: HumiColor,
    pointBackgroundColor: HumiColor,
    pointBorderColor: '#fff',
    pointHoverBackgroundColor: '#fff',
    pointHoverBorderColor: HumiColor
  }, {
    label: '土濕(%)',
    data: Mosis,
    fill: false, 
    backgroundColor: MosiColor,
    borderColor: MosiColor,
    pointBackgroundColor: MosiColor,
    pointBorderColor: '#fff',
    pointHoverBackgroundColor: '#fff',
    pointHoverBorderColor: MosiColor
 }, {
    label: '光度(Par)',
    data: reLuxs,
    fill: false, 
    backgroundColor: LuxColor,
    borderColor: LuxColor,
    pointBackgroundColor: LuxColor,
    pointBorderColor: '#fff',
    pointHoverBackgroundColor: '#fff',
    pointHoverBorderColor: LuxColor
   }]
};

  const tempConfig = {
    type: 'radar',
    data: tData,
    options: {
      scales: {
          r: {
		max: 100,
		min: 0,
              angleLines: {
                  display: true
              },
            ticks: {
//                stepSize: 10, 
            },
            suggestedMin: 0,
            suggestedMax: 100,
          }
      },
      elements: {
        line: {
          borderWidth: 3
        }
      }
    },
  };

  new Chart(ctx, tempConfig);

</script>

</body>

</html>
